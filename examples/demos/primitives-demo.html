<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primitive Creation Demo - Three-Edit</title>
    <link rel="stylesheet" href="demo-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div class="container">
        <div class="demo-header">
            <h1>Primitive Creation</h1>
            <p>Create basic and complex geometric shapes with customizable parameters</p>
            <a href="index.html" class="back-link">← Back to Demos</a>
        </div>

        <div class="demo-nav">
            <div class="nav-section">
                <button class="nav-button active" onclick="showSection('basic')">Basic Shapes</button>
                <button class="nav-button" onclick="showSection('complex')">Complex Shapes</button>
                <button class="nav-button" onclick="showSection('parametric')">Parametric</button>
                <button class="nav-button" onclick="showSection('custom')">Custom Builders</button>
            </div>
            <div class="nav-section">
                <button class="nav-button" onclick="resetScene()">Reset</button>
                <button class="nav-button" onclick="exportGeometry()">Export</button>
            </div>
        </div>

        <div class="demo-content">
            <div class="code-panel">
                <div id="basic-code" class="code-section">
                    <h3>Basic Shapes</h3>
                    <div class="code-block">
<span class="code-comment">// Create a cube</span>
<span class="code-keyword">const</span> cube = <span class="code-function">ThreeEdit</span>.<span class="code-function">createCube</span>({
    width: <span class="code-number">2</span>,
    height: <span class="code-number">2</span>,
    depth: <span class="code-number">2</span>
});

<span class="code-comment">// Create a sphere</span>
<span class="code-keyword">const</span> sphere = <span class="code-function">ThreeEdit</span>.<span class="code-function">createSphere</span>({
    radius: <span class="code-number">1</span>,
    segments: <span class="code-number">32</span>
});

<span class="code-comment">// Create a cylinder</span>
<span class="code-keyword">const</span> cylinder = <span class="code-function">ThreeEdit</span>.<span class="code-function">createCylinder</span>({
    radius: <span class="code-number">1</span>,
    height: <span class="code-number">2</span>,
    segments: <span class="code-number">16</span>
});
                    </div>
                </div>

                <div id="complex-code" class="code-section hidden">
                    <h3>Complex Shapes</h3>
                    <div class="code-block">
<span class="code-comment">// Create a torus</span>
<span class="code-keyword">const</span> torus = <span class="code-function">ThreeEdit</span>.<span class="code-function">createTorus</span>({
    radius: <span class="code-number">1</span>,
    tubeRadius: <span class="code-number">0.3</span>,
    segments: <span class="code-number">32</span>,
    tubeSegments: <span class="code-number">16</span>
});

<span class="code-comment">// Create a dodecahedron</span>
<span class="code-keyword">const</span> dodecahedron = <span class="code-function">ThreeEdit</span>.<span class="code-function">createDodecahedron</span>({
    radius: <span class="code-number">1</span>
});

<span class="code-comment">// Create a torus knot</span>
<span class="code-keyword">const</span> torusKnot = <span class="code-function">ThreeEdit</span>.<span class="code-function">createTorusKnot</span>({
    radius: <span class="code-number">1</span>,
    tubeRadius: <span class="code-number">0.3</span>,
    p: <span class="code-number">2</span>,
    q: <span class="code-number">3</span>
});
                    </div>
                </div>

                <div id="parametric-code" class="code-section hidden">
                    <h3>Parametric Shapes</h3>
                    <div class="code-block">
<span class="code-comment">// Create a plane with segments</span>
<span class="code-keyword">const</span> plane = <span class="code-function">ThreeEdit</span>.<span class="code-function">createPlane</span>({
    width: <span class="code-number">4</span>,
    height: <span class="code-number">4</span>,
    widthSegments: <span class="code-number">4</span>,
    heightSegments: <span class="code-number">4</span>
});

<span class="code-comment">// Create a cone</span>
<span class="code-keyword">const</span> cone = <span class="code-function">ThreeEdit</span>.<span class="code-function">createCone</span>({
    radius: <span class="code-number">1</span>,
    height: <span class="code-number">2</span>,
    segments: <span class="code-number">16</span>
});

<span class="code-comment">// Create a capsule</span>
<span class="code-keyword">const</span> capsule = <span class="code-function">ThreeEdit</span>.<span class="code-function">createCapsule</span>({
    radius: <span class="code-number">0.5</span>,
    height: <span class="code-number">2</span>,
    segments: <span class="code-number">16</span>
});
                    </div>
                </div>

                <div id="custom-code" class="code-section hidden">
                    <h3>Custom Geometry Builders</h3>
                    <div class="code-block">
<span class="code-comment">// Create a custom shape using vertex generators</span>
<span class="code-keyword">const</span> helpers = <span class="code-function">ThreeEdit</span>.<span class="code-function">getHelpers</span>();
<span class="code-keyword">const</span> vertices = helpers.<span class="code-function">primitives</span>.<span class="code-function">generateVertices</span>({
    type: <span class="code-string">'custom'</span>,
    generator: <span class="code-function">function</span>(u, v) {
        <span class="code-keyword">return</span> {
            x: Math.<span class="code-function">cos</span>(u) * Math.<span class="code-function">cos</span>(v),
            y: Math.<span class="code-function">sin</span>(u) * Math.<span class="code-function">cos</span>(v),
            z: Math.<span class="code-function">sin</span>(v)
        };
    }
});

<span class="code-comment">// Build geometry from vertices</span>
<span class="code-keyword">const</span> customMesh = helpers.<span class="code-function">primitives</span>.<span class="code-function">buildGeometry</span>(vertices);
                    </div>
                </div>
            </div>

            <div class="viewport-panel">
                <div class="viewport-container" id="viewport">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading 3D Scene...
                    </div>
                </div>
                <div class="viewport-info">
                    <div id="primitive-info">Select a primitive to see its properties</div>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <div class="controls-grid">
                <div class="control-group">
                    <h4>Primitive Type</h4>
                    <div class="control-item">
                        <label for="primitive-select">Shape:</label>
                        <select id="primitive-select" onchange="changePrimitive()">
                            <option value="cube">Cube</option>
                            <option value="sphere">Sphere</option>
                            <option value="cylinder">Cylinder</option>
                            <option value="cone">Cone</option>
                            <option value="plane">Plane</option>
                            <option value="torus">Torus</option>
                            <option value="dodecahedron">Dodecahedron</option>
                            <option value="icosahedron">Icosahedron</option>
                            <option value="octahedron">Octahedron</option>
                            <option value="tetrahedron">Tetrahedron</option>
                            <option value="torusKnot">Torus Knot</option>
                            <option value="capsule">Capsule</option>
                            <option value="pyramid">Pyramid</option>
                            <option value="wedge">Wedge</option>
                            <option value="ramp">Ramp</option>
                            <option value="stairs">Stairs</option>
                            <option value="pipe">Pipe</option>
                            <option value="arrow">Arrow</option>
                            <option value="handle">Handle</option>
                            <option value="roundedBox">Rounded Box</option>
                            <option value="lowPolySphere">Low Poly Sphere</option>
                            <option value="mobiusStrip">Möbius Strip</option>
                            <option value="greebleBlock">Greeble Block</option>
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <h4>Basic Parameters</h4>
                    <div class="control-item">
                        <label for="param1">Parameter 1:</label>
                        <input type="range" id="param1" min="0.1" max="5" step="0.1" value="1" onchange="updatePrimitive()">
                        <span id="param1-value">1.0</span>
                    </div>
                    <div class="control-item">
                        <label for="param2">Parameter 2:</label>
                        <input type="range" id="param2" min="0.1" max="5" step="0.1" value="1" onchange="updatePrimitive()">
                        <span id="param2-value">1.0</span>
                    </div>
                    <div class="control-item">
                        <label for="param3">Parameter 3:</label>
                        <input type="range" id="param3" min="0.1" max="5" step="0.1" value="1" onchange="updatePrimitive()">
                        <span id="param3-value">1.0</span>
                    </div>
                </div>

                <div class="control-group">
                    <h4>Segments & Quality</h4>
                    <div class="control-item">
                        <label for="segments">Segments:</label>
                        <input type="range" id="segments" min="3" max="64" step="1" value="16" onchange="updatePrimitive()">
                        <span id="segments-value">16</span>
                    </div>
                    <div class="control-item">
                        <label for="tubeSegments">Tube Segments:</label>
                        <input type="range" id="tubeSegments" min="3" max="32" step="1" value="8" onchange="updatePrimitive()">
                        <span id="tubeSegments-value">8</span>
                    </div>
                </div>

                <div class="control-group">
                    <h4>Display Options</h4>
                    <div class="control-item">
                        <label>
                            <input type="checkbox" id="show-wireframe" checked onchange="toggleWireframe()"> Wireframe
                        </label>
                    </div>
                    <div class="control-item">
                        <label>
                            <input type="checkbox" id="show-normals" onchange="toggleNormals()"> Normals
                        </label>
                    </div>
                    <div class="control-item">
                        <label>
                            <input type="checkbox" id="show-bounding-box" onchange="toggleBoundingBox()"> Bounding Box
                        </label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="createPrimitive()">Create Primitive</button>
                <button class="btn btn-secondary" onclick="randomizeParameters()">Randomize</button>
                <button class="btn btn-success" onclick="createMultiple()">Create Multiple</button>
                <button class="btn btn-danger" onclick="clearScene()">Clear Scene</button>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="status-indicator"></div>
                <span id="status-text">Ready</span>
            </div>
            <div class="status-item">
                <span id="geometry-info">Vertices: 0 | Faces: 0 | Edges: 0</span>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let currentMesh = null;
        let meshObjects = [];
        let currentPrimitive = 'cube';
        let primitiveConfigs = {
            cube: { width: 2, height: 2, depth: 2 },
            sphere: { radius: 1, segments: 16 },
            cylinder: { radius: 1, height: 2, segments: 16 },
            cone: { radius: 1, height: 2, segments: 16 },
            plane: { width: 4, height: 4, widthSegments: 4, heightSegments: 4 },
            torus: { radius: 1, tubeRadius: 0.3, segments: 32, tubeSegments: 16 },
            dodecahedron: { radius: 1 },
            icosahedron: { radius: 1 },
            octahedron: { radius: 1 },
            tetrahedron: { radius: 1 },
            torusKnot: { radius: 1, tubeRadius: 0.3, p: 2, q: 3 },
            capsule: { radius: 0.5, height: 2, segments: 16 },
            pyramid: { width: 2, height: 2, depth: 2 },
            wedge: { width: 2, height: 2, depth: 2 },
            ramp: { width: 2, height: 1, depth: 2, steps: 4 },
            stairs: { width: 2, height: 2, depth: 2, steps: 5 },
            pipe: { radius: 0.5, height: 2, thickness: 0.1, segments: 16 },
            arrow: { length: 2, headLength: 0.5, headWidth: 0.3, shaftRadius: 0.1 },
            handle: { radius: 0.5, height: 2, gripRadius: 0.3, segments: 16 },
            roundedBox: { width: 2, height: 2, depth: 2, radius: 0.2, segments: 8 },
            lowPolySphere: { radius: 1, segments: 8 },
            mobiusStrip: { radius: 1, width: 0.3, segments: 32, twists: 1 },
            greebleBlock: { width: 2, height: 2, depth: 2, complexity: 0.5 }
        };

        // Initialize the scene
        function initScene() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x2c3e50);

            // Create camera
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera.position.set(5, 5, 5);

            // Create renderer
            const container = document.getElementById('viewport');
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.innerHTML = '';
            container.appendChild(renderer.domElement);

            // Add controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Add lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);

            // Add grid
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);

            // Start animation loop
            animate();

            // Handle window resize
            window.addEventListener('resize', onWindowResize);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.getElementById('viewport');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Section navigation
        function showSection(sectionName) {
            // Hide all code sections
            document.querySelectorAll('.code-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            document.getElementById(sectionName + '-code').classList.remove('hidden');

            // Update navigation buttons
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update status
            updateStatus('Showing ' + sectionName + ' shapes');
        }

        // Primitive creation functions
        function createPrimitive() {
            clearScene();
            
            try {
                const config = getCurrentConfig();
                const primitiveName = 'create' + currentPrimitive.charAt(0).toUpperCase() + currentPrimitive.slice(1);
                
                if (ThreeEdit[primitiveName]) {
                    currentMesh = ThreeEdit[primitiveName](config);
                } else {
                    updateStatus('Primitive not available: ' + currentPrimitive, 'error');
                    return;
                }

                // Convert to Three.js geometry
                const geometry = ThreeEdit.toBufferGeometry(currentMesh);
                const material = new THREE.MeshPhongMaterial({ 
                    color: getRandomColor(),
                    transparent: true,
                    opacity: 0.8
                });
                
                const mesh = new THREE.Mesh(geometry, material);
                scene.add(mesh);
                meshObjects.push(mesh);

                // Add wireframe if enabled
                if (document.getElementById('show-wireframe').checked) {
                    addWireframe(geometry);
                }

                updateGeometryInfo();
                updateStatus(currentPrimitive + ' created successfully');
                
            } catch (error) {
                updateStatus('Error creating ' + currentPrimitive + ': ' + error.message, 'error');
            }
        }

        function getCurrentConfig() {
            const config = { ...primitiveConfigs[currentPrimitive] };
            
            // Update config based on current controls
            const param1 = parseFloat(document.getElementById('param1').value);
            const param2 = parseFloat(document.getElementById('param2').value);
            const param3 = parseFloat(document.getElementById('param3').value);
            const segments = parseInt(document.getElementById('segments').value);
            const tubeSegments = parseInt(document.getElementById('tubeSegments').value);

            // Apply parameters based on primitive type
            switch (currentPrimitive) {
                case 'cube':
                    config.width = param1;
                    config.height = param2;
                    config.depth = param3;
                    break;
                case 'sphere':
                    config.radius = param1;
                    config.segments = segments;
                    break;
                case 'cylinder':
                    config.radius = param1;
                    config.height = param2;
                    config.segments = segments;
                    break;
                case 'torus':
                    config.radius = param1;
                    config.tubeRadius = param2;
                    config.segments = segments;
                    config.tubeSegments = tubeSegments;
                    break;
                case 'plane':
                    config.width = param1;
                    config.height = param2;
                    config.widthSegments = segments;
                    config.heightSegments = tubeSegments;
                    break;
                default:
                    // For other primitives, just update segments if available
                    if (config.segments !== undefined) {
                        config.segments = segments;
                    }
                    if (config.tubeSegments !== undefined) {
                        config.tubeSegments = tubeSegments;
                    }
            }

            return config;
        }

        function changePrimitive() {
            currentPrimitive = document.getElementById('primitive-select').value;
            updateParameterLabels();
            updateStatus('Selected primitive: ' + currentPrimitive);
        }

        function updateParameterLabels() {
            const config = primitiveConfigs[currentPrimitive];
            const param1Label = document.querySelector('label[for="param1"]');
            const param2Label = document.querySelector('label[for="param2"]');
            const param3Label = document.querySelector('label[for="param3"]');

            switch (currentPrimitive) {
                case 'cube':
                    param1Label.textContent = 'Width:';
                    param2Label.textContent = 'Height:';
                    param3Label.textContent = 'Depth:';
                    break;
                case 'sphere':
                    param1Label.textContent = 'Radius:';
                    param2Label.textContent = 'Parameter 2:';
                    param3Label.textContent = 'Parameter 3:';
                    break;
                case 'cylinder':
                    param1Label.textContent = 'Radius:';
                    param2Label.textContent = 'Height:';
                    param3Label.textContent = 'Parameter 3:';
                    break;
                case 'torus':
                    param1Label.textContent = 'Radius:';
                    param2Label.textContent = 'Tube Radius:';
                    param3Label.textContent = 'Parameter 3:';
                    break;
                case 'plane':
                    param1Label.textContent = 'Width:';
                    param2Label.textContent = 'Height:';
                    param3Label.textContent = 'Parameter 3:';
                    break;
                default:
                    param1Label.textContent = 'Parameter 1:';
                    param2Label.textContent = 'Parameter 2:';
                    param3Label.textContent = 'Parameter 3:';
            }
        }

        function updatePrimitive() {
            // Update value displays
            document.getElementById('param1-value').textContent = document.getElementById('param1').value;
            document.getElementById('param2-value').textContent = document.getElementById('param2').value;
            document.getElementById('param3-value').textContent = document.getElementById('param3').value;
            document.getElementById('segments-value').textContent = document.getElementById('segments').value;
            document.getElementById('tubeSegments-value').textContent = document.getElementById('tubeSegments').value;

            // Recreate primitive if one exists
            if (currentMesh) {
                createPrimitive();
            }
        }

        function randomizeParameters() {
            document.getElementById('param1').value = (Math.random() * 4 + 0.1).toFixed(1);
            document.getElementById('param2').value = (Math.random() * 4 + 0.1).toFixed(1);
            document.getElementById('param3').value = (Math.random() * 4 + 0.1).toFixed(1);
            document.getElementById('segments').value = Math.floor(Math.random() * 32) + 8;
            document.getElementById('tubeSegments').value = Math.floor(Math.random() * 16) + 4;
            
            updatePrimitive();
            updateStatus('Parameters randomized');
        }

        function createMultiple() {
            for (let i = 0; i < 5; i++) {
                const config = getCurrentConfig();
                const primitiveName = 'create' + currentPrimitive.charAt(0).toUpperCase() + currentPrimitive.slice(1);
                
                if (ThreeEdit[primitiveName]) {
                    const mesh = ThreeEdit[primitiveName](config);
                    const geometry = ThreeEdit.toBufferGeometry(mesh);
                    const material = new THREE.MeshPhongMaterial({ 
                        color: getRandomColor(),
                        transparent: true,
                        opacity: 0.6
                    });
                    
                    const threeMesh = new THREE.Mesh(geometry, material);
                    threeMesh.position.set(
                        (Math.random() - 0.5) * 8,
                        (Math.random() - 0.5) * 8,
                        (Math.random() - 0.5) * 8
                    );
                    scene.add(threeMesh);
                    meshObjects.push(threeMesh);
                }
            }
            
            updateStatus('Created 5 random primitives');
        }

        function clearScene() {
            meshObjects.forEach(obj => scene.remove(obj));
            meshObjects = [];
            currentMesh = null;
            
            updateGeometryInfo();
            updateStatus('Scene cleared');
        }

        function resetScene() {
            clearScene();
            createPrimitive();
        }

        function toggleWireframe() {
            const showWireframe = document.getElementById('show-wireframe').checked;
            
            // Remove existing wireframes
            meshObjects = meshObjects.filter(obj => {
                if (obj instanceof THREE.LineSegments) {
                    scene.remove(obj);
                    return false;
                }
                return true;
            });

            // Add wireframe if enabled and we have a mesh
            if (showWireframe && currentMesh) {
                const geometry = ThreeEdit.toBufferGeometry(currentMesh);
                addWireframe(geometry);
            }
        }

        function addWireframe(geometry) {
            const wireframe = new THREE.WireframeGeometry(geometry);
            const wireframeMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
            const wireframeMesh = new THREE.LineSegments(wireframe, wireframeMaterial);
            scene.add(wireframeMesh);
            meshObjects.push(wireframeMesh);
        }

        function toggleNormals() {
            updateStatus('Normals display not implemented yet');
        }

        function toggleBoundingBox() {
            updateStatus('Bounding box display not implemented yet');
        }

        function exportGeometry() {
            if (!currentMesh) {
                updateStatus('No geometry to export', 'error');
                return;
            }

            try {
                const geometry = ThreeEdit.toBufferGeometry(currentMesh);
                const json = geometry.toJSON();
                
                // Create download link
                const dataStr = JSON.stringify(json, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = currentPrimitive + '_geometry.json';
                link.click();
                
                URL.revokeObjectURL(url);
                updateStatus('Geometry exported successfully');
                
            } catch (error) {
                updateStatus('Error exporting geometry: ' + error.message, 'error');
            }
        }

        // Utility functions
        function getRandomColor() {
            const colors = [0x667eea, 0x764ba2, 0xf093fb, 0xf5576c, 0x4facfe, 0x00f2fe, 0x43e97b, 0x38f9d7];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function updateGeometryInfo() {
            if (currentMesh) {
                const vertices = currentMesh.vertices.length;
                const faces = currentMesh.faces.length;
                const edges = currentMesh.edges.length;
                document.getElementById('geometry-info').textContent = 
                    `Vertices: ${vertices} | Faces: ${faces} | Edges: ${edges}`;
            } else {
                document.getElementById('geometry-info').textContent = 'Vertices: 0 | Faces: 0 | Edges: 0';
            }
        }

        function updateStatus(message, type = 'info') {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            statusText.textContent = message;
            
            indicator.className = 'status-indicator';
            if (type === 'error') {
                indicator.classList.add('error');
            } else if (type === 'warning') {
                indicator.classList.add('warning');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            // Check if ThreeEdit is available
            if (typeof ThreeEdit === 'undefined') {
                updateStatus('ThreeEdit library not loaded. Please include the UMD build.', 'error');
                return;
            }
            
            initScene();
            updateParameterLabels();
            createPrimitive();
        });
    </script>
</body>
</html> 